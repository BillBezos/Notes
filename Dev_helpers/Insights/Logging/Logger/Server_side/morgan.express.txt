
          
   MORGAN  
          



ALTERNATIVES ==>              #See winston

VERSION ==>                   #1.9.1

MORGAN(STR|OBJ)->MDWR         #Express MIDWR that logs REQ|RES.* basic info.
                              #STR is same as { format STR }
                              #OBJ:
                              #  - format STR:
                              #     - any STR with format strings:
                              #        - :req|res[Header] (e.g. :req[Content-Length])
                              #        - :http-version
                              #        - :response-time
                              #        - :remote-addr
                              #        - :date
                              #        - :method
                              #        - :url
                              #        - :referrer
                              #        - :user-agent
                              #        - :status
                              #        - :CUSTOM[FIELD], after calling MORGAN.token(CUSTOM_STR, FUNC(REQ, RES[, FIELD])->STR)
                              #     - predefined:
                              #        - "default" (def): ':remote-addr - - [:date] :method :url HTTP/:http-version :status :res[content-length]                      ":referrer" ":user-agent"'
                              #        - "short":         ':remote-addr -           :method :url HTTP/:http-version :status :res[content-length] - :response-time ms'
                              #        - "tiny":          '                         :method :url                    :status :res[content-length] - :response-time ms'
                              #        - "dev": same, with colors
                              #     - CUSTOM, after calling MORGAN.format(CUSTOM_STR, STR2)
                              #  - stream OSTREAM (def: stdout)
                              #  - buffer NUM (in ms, 1000 if true)
                              #  - immediate: if true, write on request, if false, write on response.
                              #  - skip FUNC(REQ,RES)->BOOL: if true, does not log

morgan(['FORMAT'|TEMPLATE][, OPTS])->MDWR
                              #Express MDWR that logs each request to OPTS.stream (def: process.stdout)
                              #What's logged is 'FORMAT'|TEMPLATE (def: 'default' 'FORMAT')
                              #OPTS:
                              #  - immediate BOOL (def: false)
                              #  - skip(REQ, RES)->BOOL:
                              #     - do not log request if false
                              #     - can also return undefined|null with TEMPLATE_FUNC

TEMPLATE                      #'TEMPLATE'|TEMPLATE_FUNC
'TEMPLATE'                    #Template string with :TOKEN placeholders.
TEMPLATE_FUNC                 #FUNC(TOKENS, REQ, RES)->STR
compile('TEMPLATE')
 ->TEMPLATE_FUNC              #Replaces :TOKEN placeholders inside 'TEMPLATE'

'FORMAT'                      #Predefined TEMPLATE
format('FORMAT', TEMPLATE)    #Register a 'FORMAT'

:TOKEN                        #Replaced by TOKEN()->STR
:TOKEN[ARG]                   #[ARG] use actual square brackets.
                              #TOKEN is [:alnum:]_-
TOKEN(REQ, RES, ARG)->STR     #Placeholder template function.
                              #If returns falsy, replaced by '-' instead
TOKENS                        #{ TOKEN(), ... }
token('TOKEN', TOKEN())       #Register a :TOKEN
