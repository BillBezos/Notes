
              
   SOURCE_MAP  
              



VERSION ==>                       #18/11/2013 (revision 3 proposal)

GOAL ==>                          #Map positions and variable names from a compiled file to a source file
                                  #Reason: allowing to debug compiled file using source file
                                  #Can:
                                  #  - be inlined ("inline source map") or a separate file
                                  #  - be concatenated ("index map")
                                  #  - work with multi-stage compilation ("multi-level map")


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            FORMAT             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


FORMAT ==>                        #JSON

version                           #3 (required)

sources                           #Source files 'PATH'_ARR
sourceRoot                        #Source files 'DIR' (prepended to "sources")
                                  #sources + sourceRoot are relative URIs to source map's directory.
sourceContent                     #Source files STR|null_ARR: like "sources" but inline
names                             #Source files 'VAR'_ARR list of identifiers

file                              #Source map's 'FILENAME'
                                  #Usually re-use source filename and append '.map'

mappings                          #MAPPINGS (required)

x_*                               #Extensions
x_google_linecount                #Source files number of lines


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           MAPPINGS            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


MAPPINGS                          #Map each position within compiled file to a position (and 'VAR' name) within source file
                                  #A MAPPINGS is ;-separated into GROUPs
GROUP                             #A line in source file
                                  #A GROUP is ,-separated into SEGMENTs
SEGMENT                           #A variable name/position
                                  #Is a VLQ_INT_ARR ("fields") of length 1|4|5
                                  #Fields:
                                  #  - represents "position" of:
                                  #     0) index in compiled file
                                  #     1) source file among "sources"
                                  #     2) line in source file
                                  #     3) column in the source line
                                  #     4) the 'VAR' name among source "names"
                                  #  - only 0) is required
                                  #Each "position" is relative offset:
                                  #  - unless it is the first occurence, in which case it is absolute position
                                  #  - for segment 0) it also is absolute position for first segment of each group
                                  #VLQ_INT is a 32 bits signed integer, encoded using source map's VLQ (see its doc)


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           INDEX MAP           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


INDEX MAP ==>                     #When concatenating several "sections" (source files + compiled file + source map) into a single bundled file
                                  #Can be used the same way as source maps

version                           #3
file                              #Source map's 'FILENAME'
sections                          #OBJ_ARR
                                  #Must be sorted by position and not overlap.
sections.*.line|column            #Position within the bundled file
sections.*.url                    #URL of the source map
                                  #Resolved the same way as "sources" and "sourceRoot"
sections.*.map                    #Same but inlined, i.e. OBJ of the source map


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           LOCATION            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


SOURCE MAP LOCATION ==>           #Can be:
                                  #  - sibling file to the compiled file with '.map' appended
                                  #  - comment "# sourceMappingURL=URI" at end of compiled file
                                  #     - should use format's comment marker, e.g. //# ... for JavaScript, /* */ for CSS
                                  #  - [X-]SourceMap: URI [S] HTTP header
                                  #URLs are relative to:
                                  #  - <script src>
                                  #  - comment "# sourceURL=URL"
                                  #     - should be "foo.js" if there is no file (e.g. genereted with eval())
                                  #  - parent page's URL

INLINE SOURCE MAP ==>             #Using a "//# sourceMappingURL=DATA_URI" + sourceContents + sections.*.map


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:      MULTI-LEVEL MAPPING      :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


MULTI-LEVEL MAPPING ==>           #When there are several compilation stages, e.g. TypeScript + Minification
                                  #Possible solutions:
                                  #  - single source map from last compiled file to source file
                                  #  - single source map from last compiled file to intermediary compiled file
                                  #  - several source maps for each stage
