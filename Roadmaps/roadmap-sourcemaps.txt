
                      
   ROADMAP-SOURCEMAPS  
                      



Should target Node 6.0

GitHub/npm organization "sourcemaps" and @sourcemaps scope (@sourcemaps/has)

Separate the content|location utility checker

@sourcemaps/regex

@sourcemaps/has(content|location)->BOOL
  - tries to fetch sibling `.map` file like get()

@sourcemaps/get(content|location)->{ location, inline, multiline }
  - location is either external URI|path or full data URI
  - no format nor mime check
  - no base64 nor JSON parsing
  - inline is boolean
  - tries to fetch sibling `.map` file:
     - do it in parallel right away
     - but only use it if no sourceMappingURL comment

@sourcemaps/remove(content)->content

@sourcemaps/set(content, location[, { multiline }])->content
  - remove() then append

@sourcemaps/validate(sourcemapContent|sourcemapLocation)[->ERROR]
  - check source map syntax

@sourcemaps/fetch(sourcemapLocation|res[, { cwd }])->{ location, inline, multiline, sourcemap, validate }
  - check format and MIME if data URI
  - base64 decoding if data URI
  - HTTP[S] fetch or local file read if external
  - JSON parsing
  - validate() if true (def: false)

@sourcemaps/read(content|location[, { cwd }])->{ location, inline, multiline, sourcemap, validate }
  - get()
  - fetch()

@sourcemaps/write(path, sourcemap[, { cwd, inline, multiline, validate }]):
  - set()
  - validate() if true (def: false)
  - persist file
  - persist source map (unless inline)
  - inline|multiline default to same as current one

@sourcemaps/delete(path[, { cwd }]):
  - remove() but persist file and remove source map file too

@sourcemaps/transform(path, function[, { cwd, inline, multiline, validate, all }])
  - read() then function then write()
  - function is FUNC(sourcemap)[->sourcemap]
     - can return `undefined` to remove sourcemap
     - if opts.all true (def: false), called with `undefined` when no sourcemap (i.e. creates one)

@sourcemaps/copy(path, origPath)
  - goal: copy|move directory/file without breaking source maps
  - transform() using function:
     - if there is a source map, modify its sourceRoot:
        - if sourceRoot absolute: do nothing
        - if sourceRoot relative: set as path.posix.relative(sourceRoot, dirname(ORIG_FILE))
           - note: source map format only allows forward slashes
        - if sourceRoot absent:
           - if all "sources" are absolute: do nothing
           - set as path.posix.relative(dirname(DEST_FILE), dirname(ORIG_FILE))
     - if there is no source map, generate:
        - version: 3
        - sourceRoot: ORIG_DIR (i.e. common ancestors of all ORIG_FILE)
        - file: path.posix.relative(ORIG_DIR, ORIG_FILE)
        - sources: [basename(ORIG_FILE)]
        - sourcesContent: [JSON.stringify(readFile(ORIG_FILE, { encoding: 'utf-8' }))]
        - names: nothing
        - mappings: use source-list-map modules (i.e. line-by-line mapping)
           - (new SourceListNode(sourcesContent, file, sourcesContent)).getMappings(new MappingsContext)
           - can do token-by-token mapping when creating a new source map like IDENTITY-MAP does,
             i.e. by parsing with language-specific parser
              - fallback to line-by-line mapping

Documentation check:
  - check old source map versions differences
  - fix source map documentation about uri vs path

support //# sourceURL

Index maps???

Other tools like concat???

Dir recursion on any above???

Streaming???

Vinyl support???
