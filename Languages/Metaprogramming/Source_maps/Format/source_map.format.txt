
              
   SOURCE_MAP  
              



VERSION ==>                       #18/11/2013 (revision 3 proposal)

GOAL ==>                          #Map positions and variable names from a compiled file to a source file
                                  #Reason: allowing to debug compiled file using source file
                                  #Can:
                                  #  - be inlined ("inline source map") or a separate file
                                  #  - be concatenated ("index map")
                                  #  - work with multi-stage compilation ("multi-level map")


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            FORMAT             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


FORMAT ==>                        #JSON

version                           #3 (required)

sources                           #Source files' 'SOURCE_PATH'_ARR
sourceRoot                        #Source files' 'DIR' (prepended to "sources")
                                  #sources + sourceRoot are relative URIs to source map's directory.
sourceContent                     #Source files' STR|null_ARR: like "sources" but inline
                                  #Index corresponds to index within "sources"
names                             #Source files' 'SOURCE_CODE'_ARR (usually mostly identifiers)

file                              #Compiled file's 'COMPILED_FILENAME'

mappings                          #MAPPINGS (required)

x_*                               #Extensions
x_google_linecount                #Source files number of lines


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           MAPPINGS            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


MAPPINGS                          #Map each position within compiled file to a position (and 'SOURCE_CODE') within source file
                                  #A MAPPINGS is ;-separated into GROUPs
GROUP                             #A line in source file
                                  #A GROUP is ,-separated into SEGMENTs
SEGMENT                           #A variable name/position
                                  #Is a VLQ_INT_ARR ("fields") of length 1|4|5
                                  #Fields:
                                  #  - represents "position" of:
                                  #     0) index in compiled file
                                  #     1) source file among "sources"
                                  #     2) line in source file (1-based)
                                  #     3) column in the source line (0-based)
                                  #     4) the 'SOURCE_CODE' name among source "names"
                                  #  - only 0) is required
                                  #Each "position" is relative offset to last field:
                                  #  - unless it is the first occurence, in which case it is absolute position
                                  #  - for segment 0) it also is absolute position for first segment of each group
                                  #  - can be negative offset, e.g. when returning to line 1 on new source file,
                                  #    or returning to column 0 on new line
                                  #VLQ_INT is a 32 bits signed integer, encoded using source map's VLQ (see its doc)


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           INDEX MAP           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


INDEX MAP ==>                     #When concatenating several "sections" (source files + compiled file + source map) into a single bundled file
                                  #Can be used the same way as source maps

version                           #3
file                              #Index map's 'SOURCEMAP_FILENAME'
sections                          #OBJ_ARR
                                  #Must be sorted by position and not overlap.
sections.*.line|column            #Position within the bundled file
sections.*.url                    #URL of the source map
                                  #Resolved the same way as "sources" and "sourceRoot"
sections.*.map                    #Same but inlined, i.e. OBJ of the source map


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           LOCATION            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


SOURCE MAP LOCATION ==>           #Can be:
                                  #  - sibling file to the compiled file with '.map' appended
                                  #  - comment "# sourceMappingURL=SOURCEMAP_URI" at end of compiled file
                                  #     - should use format's comment marker, e.g. //# ... for JavaScript, /* */ for CSS
                                  #  - [X-]SourceMap: SOURCEMAP_URI [S] HTTP header
                                  #SOURCEMAP_URLs are relative to:
                                  #  - <script src>
                                  #  - comment "# sourceURL=URL"
                                  #     - should be "foo.js" if there is no file (e.g. genereted with eval())
                                  #  - parent page's URL

INLINE SOURCE MAP ==>             #Using a SOURCEMAP_URI data URI + sourceContents + sections.*.map


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:      MULTI-LEVEL MAPPING      :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


MULTI-LEVEL MAPPING ==>           #When there are several compilation stages, e.g. TypeScript + Minification
                                  #Possible solutions:
                                  #  - single source map from last compiled file to source file
                                  #  - single source map from last compiled file to intermediary compiled file
                                  #  - several source maps for each stage
